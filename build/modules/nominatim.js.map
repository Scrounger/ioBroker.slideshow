{
  "version": 3,
  "sources": ["../../src/modules/nominatim.ts"],
  "sourcesContent": ["import { GlobalHelper } from \"./global-helper\";\r\nimport nominatim from \"nominatim-client\";\r\nimport { devNull } from \"node:os\";\r\nimport moment from \"moment\";\r\n\r\nexport interface locationInfos {\r\n\tcountry: string | null;\r\n\tstate: string | null;\r\n\tcounty: string | null;\r\n\tcity: string | null;\r\n\tdisplay_name: string | null;\r\n}\r\n\r\nlet time: moment.Moment | null = null;\r\nconst blockTimeout = 30;\r\n\r\nexport async function getLocationInfos(Helper: GlobalHelper, CurrentPictureResult: any): Promise<locationInfos | null> {\r\n\ttry {\r\n\t\tconst locationInfos = await downloadLocationInfos(Helper, CurrentPictureResult);\r\n\t\tlet result = null;\r\n\r\n\t\tif (locationInfos) {\r\n\t\t\tresult = {\r\n\t\t\t\tcountry: locationInfos.address && locationInfos.address.country ? locationInfos.address.country : null,\r\n\t\t\t\tstate: locationInfos.address && locationInfos.address.state ? locationInfos.address.state : null,\r\n\t\t\t\tcounty: locationInfos.address && locationInfos.address.county ? locationInfos.address.county : null,\r\n\t\t\t\tcity: locationInfos.address && locationInfos.address.city ? locationInfos.address.city : null,\r\n\t\t\t\tdisplay_name: locationInfos.display_name ? locationInfos.display_name : null\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t} catch (error) {\r\n\t\tHelper.ReportingError(error as Error, `${CurrentPictureResult.path} Unknown Error`, \"exifr\", \"getLocationInfos\");\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nasync function downloadLocationInfos(Helper: GlobalHelper, CurrentPictureResult: any): Promise<any | null> {\r\n\ttry {\r\n\t\tmoment()\r\n\t\tif (time === null || moment().diff(time, 'minutes') >= blockTimeout) {\r\n\t\t\tconst client = nominatim.createClient({\r\n\t\t\t\tuseragent: `ioBroker-slideshow-${(Math.random() * (100000 - 1)) + 1}@iobroker.net`,             // The name of your application\r\n\t\t\t\treferer: 'https://nominatim.openstreetmap.org',  // The referer link\r\n\t\t\t});\r\n\r\n\t\t\tconst query = {\r\n\t\t\t\tlat: CurrentPictureResult.latitude.toFixed(8),\r\n\t\t\t\tlon: CurrentPictureResult.longitude.toFixed(8),\r\n\t\t\t\tzoom: 18,\r\n\t\t\t\t\"accept-language\": Helper.getLanguage()\r\n\t\t\t};\r\n\r\n\t\t\treturn new Promise(resolve => {\r\n\t\t\t\tclient.reverse(query).then((result) => {\r\n\t\t\t\t\tHelper.ReportingInfo(\"Debug\", \"Adapter\", `[downloadLocationInfos]: ${JSON.stringify(result)}`);\r\n\t\t\t\t\ttime = null;\r\n\t\t\t\t\tresolve(result);\r\n\t\t\t\t}).catch((error) => {\r\n\t\t\t\t\tHelper.ReportingError(error as Error, `${CurrentPictureResult.path}, query: ${JSON.stringify(query)} Unknown Error`, \"exifr\", \"downloadLocationInfos\");\r\n\t\t\t\t\ttime = moment();\r\n\t\t\t\t\tresolve(undefined);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tHelper.ReportingInfo(\"Debug\", \"downloadLocationInfos\", `Blocking prevention - waiting ${blockTimeout - moment().diff(time, 'minutes')} Min.`);\r\n\t\t}\r\n\r\n\t} catch (error) {\r\n\t\tHelper.ReportingError(error as Error, `${CurrentPictureResult.path} Unknown Error`, \"exifr\", \"downloadLocationInfos\");\r\n\t\treturn null;\r\n\t}\r\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AACA,8BAAsB;AAEtB,oBAAmB;AAUnB,IAAI,OAA6B;AACjC,MAAM,eAAe;AAErB,gCAAuC,QAAsB,sBAA0D;AACtH,MAAI;AACH,UAAM,gBAAgB,MAAM,sBAAsB,QAAQ;AAC1D,QAAI,SAAS;AAEb,QAAI,eAAe;AAClB,eAAS;AAAA,QACR,SAAS,cAAc,WAAW,cAAc,QAAQ,UAAU,cAAc,QAAQ,UAAU;AAAA,QAClG,OAAO,cAAc,WAAW,cAAc,QAAQ,QAAQ,cAAc,QAAQ,QAAQ;AAAA,QAC5F,QAAQ,cAAc,WAAW,cAAc,QAAQ,SAAS,cAAc,QAAQ,SAAS;AAAA,QAC/F,MAAM,cAAc,WAAW,cAAc,QAAQ,OAAO,cAAc,QAAQ,OAAO;AAAA,QACzF,cAAc,cAAc,eAAe,cAAc,eAAe;AAAA;AAAA;AAI1E,WAAO;AAAA,WAEC,OAAP;AACD,WAAO,eAAe,OAAgB,GAAG,qBAAqB,sBAAsB,SAAS;AAC7F,WAAO;AAAA;AAAA;AAIT,qCAAqC,QAAsB,sBAAgD;AAC1G,MAAI;AACH;AACA,QAAI,SAAS,QAAQ,6BAAS,KAAK,MAAM,cAAc,cAAc;AACpE,YAAM,SAAS,gCAAU,aAAa;AAAA,QACrC,WAAW,sBAAuB,KAAK,WAAY,OAAS,KAAM;AAAA,QAClE,SAAS;AAAA;AAGV,YAAM,QAAQ;AAAA,QACb,KAAK,qBAAqB,SAAS,QAAQ;AAAA,QAC3C,KAAK,qBAAqB,UAAU,QAAQ;AAAA,QAC5C,MAAM;AAAA,QACN,mBAAmB,OAAO;AAAA;AAG3B,aAAO,IAAI,QAAQ,aAAW;AAC7B,eAAO,QAAQ,OAAO,KAAK,CAAC,WAAW;AACtC,iBAAO,cAAc,SAAS,WAAW,4BAA4B,KAAK,UAAU;AACpF,iBAAO;AACP,kBAAQ;AAAA,WACN,MAAM,CAAC,UAAU;AACnB,iBAAO,eAAe,OAAgB,GAAG,qBAAqB,gBAAgB,KAAK,UAAU,wBAAwB,SAAS;AAC9H,iBAAO;AACP,kBAAQ;AAAA;AAAA;AAAA,WAGJ;AACN,aAAO,cAAc,SAAS,yBAAyB,iCAAiC,eAAe,6BAAS,KAAK,MAAM;AAAA;AAAA,WAGpH,OAAP;AACD,WAAO,eAAe,OAAgB,GAAG,qBAAqB,sBAAsB,SAAS;AAC7F,WAAO;AAAA;AAAA;",
  "names": []
}
